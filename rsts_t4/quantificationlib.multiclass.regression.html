

<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>quantificationlib.multiclass.regression module &#8212; quantificationlib 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="quantificationlib.ordinal package" href="quantificationlib.ordinal.html" />
    <link rel="prev" title="quantificationlib.multiclass.knn module" href="quantificationlib.multiclass.knn.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="quantificationlib.ordinal.html" title="quantificationlib.ordinal package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="quantificationlib.multiclass.knn.html" title="quantificationlib.multiclass.knn module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">quantificationlib 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="quantificationlib.multiclass.html" accesskey="U">quantificationlib.multiclass package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">quantificationlib.multiclass.regression module</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-quantificationlib.multiclass.regression">
<span id="quantificationlib-multiclass-regression-module"></span><h1>quantificationlib.multiclass.regression module<a class="headerlink" href="#module-quantificationlib.multiclass.regression" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REG">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">REG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bag_generator=&lt;quantificationlib.bag_generator.PriorShift_BagGenerator</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bins=8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bin_strategy='equal_width'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regression_estimator=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REG"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REG" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>REG base class for REGX y REGy</p>
<blockquote>
<div><p>The idea of these quantifiers is to learn a regression model able to predict the prevalences. To learn said
regression model, this kind of objects generates a training set of bag of examples using a selected kind of
shift (prior probability shift, covariate shift or a mix of both). The training set contains a collection of
pairs (PDF distribution, prevalences) in which each pair is obtained from a bag of examples. The PDF tries
to capture the distribution of the bag.</p>
<dl>
<dt>bag_generator<span class="classifier">BagGenerator object (default=PriorShift_BagGenerator())</span></dt><dd><p>Object to generate the bags with a selected shift</p>
</dd>
<dt>n_bins<span class="classifier">int (default=8)</span></dt><dd><p>Number of bins to compute the PDF of each distribution</p>
</dd>
<dt>bin_strategy<span class="classifier">str (default=’normal’)</span></dt><dd><dl>
<dt>Method to compute the boundaries of the bins:</dt><dd><p>‘equal_width’: bins of equal length (it could be affected by outliers)
‘equal_count’: bins of equal counts (considering the examples of all classes)
‘binormal’: (Only for binary quantification) It is inspired on the method devised by</p>
<blockquote>
<div><blockquote>
<div><p>(Tasche, 2019, Eq (A16b)). the cut points, $-infty &lt; c_1 &lt; ldots &lt; c_{b-1} &lt; infty$,
are computed as follows based on the assumption that the features follow a normal
distribution:</p>
</div></blockquote>
<p>$c_i =</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>rac{sigma^+ + sigma^{-}}{2} Phi^{-1}igg(
rac{i}{b}igg)  +
rac{mu^+ + mu^{-}}{2} ,  quad i=1,ldots,b-1$</p>
<blockquote>
<div><blockquote>
<div><p>where $Phi^{-1}$ is the quantile function of the standard normal distribution, and $mu$
and $sigma$ of the normal distribution are estimated as the average of those values for
the training examples of each class.</p>
</div></blockquote>
<dl>
<dt>‘normal’:  The idea is that each feacture follows a normal distribution. $mu$ and $sigma$ are</dt><dd><p>estimated as the weighted mean and std from the training distribution. The cut points
$-infty &lt; c_1 &lt; ldots &lt; c_{b-1} &lt; infty$ are computed as follows:</p>
<p>$c_i = sigma^ Phi^{-1}igg(</p>
</dd>
</dl>
</div></blockquote>
<p>rac{i}{b}igg)  + mu ,  quad i=1,ldots,b-1$</p>
<blockquote>
<div><dl class="simple">
<dt>regression_estimator: estimator object (default=None)</dt><dd><p>A regression estimator object. If the value is None the regression estimator used is a Generalized Linear
Model (GLM) from statsmodels package with logit link and Binomial family as parameters (see Baum 2008).
It is used to learn a regression model able to predict the prevalence for each class, so the method will
fit as many regression estimators as classes in multiclass problems and just one for binary problems.</p>
</dd>
<dt>verbose<span class="classifier">int, optional, (default=0)</span></dt><dd><p>The verbosity level. The default value, zero, means silent mode</p>
</dd>
</dl>
<dl class="simple">
<dt>bag_generator<span class="classifier">BagGenerator object</span></dt><dd><p>Object to generate the bags with a selected shift</p>
</dd>
<dt>n_bins<span class="classifier">int</span></dt><dd><p>Number of bins to compute the PDF of each distribution</p>
</dd>
<dt>bin_strategy<span class="classifier">str</span></dt><dd><p>Method to compute the boundaries of the bins</p>
</dd>
<dt>regression_estimator: estimator object, None</dt><dd><p>A regression estimator object</p>
</dd>
<dt>verbose<span class="classifier">int</span></dt><dd><p>The verbosity level</p>
</dd>
<dt><a href="#id1"><span class="problematic" id="id2">dataX_</span></a><span class="classifier">array-like, shape(n_bags, n_features)</span></dt><dd><p>X data for training REGX/REGy’s regressor model. Each row corresponds to the collection of histograms (one
per input feature) of the corresponding bag</p>
</dd>
<dt><a href="#id3"><span class="problematic" id="id4">dataY_</span></a><span class="classifier">array-like, shape(n_bags, n_classes)</span></dt><dd><p>Y data for training REGX/REGy’s regressor model. Each value corresponds to the prevalences of the
corresponding bag</p>
</dd>
<dt><a href="#id5"><span class="problematic" id="id6">bincuts_</span></a><span class="classifier">ndarray, shape (n_features, n_bins + 1)</span></dt><dd><p>Bin cuts for each feature</p>
</dd>
<dt><a href="#id7"><span class="problematic" id="id8">estimators_</span></a><span class="classifier">array of estimators, shape (n_classes, ) multiclass (1, ) binary quantification</span></dt><dd><p>It stores the estimators. For multiclass problems, the method learns an individual estimator
for each class</p>
</dd>
<dt><a href="#id9"><span class="problematic" id="id10">models_</span></a><span class="classifier">array of models, i.e., fitted estimators, shape (n_classes, )</span></dt><dd><p>This is the fitted regressor model for each class. It is needed when regression_estimator is None and
a GML models are used (these objects do not store the fitted model).</p>
</dd>
<dt><a href="#id11"><span class="problematic" id="id12">n_classes_</span></a><span class="classifier">int</span></dt><dd><p>The number of classes</p>
</dd>
</dl>
<p>Christopher F. Baum: Stata tip 63: Modeling proportions. The Stata Journal 8.2 (2008): 299-303</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REG.create_training_set_of_distributions">
<span class="sig-name descname"><span class="pre">create_training_set_of_distributions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">att_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REG.create_training_set_of_distributions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REG.create_training_set_of_distributions" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a training set for REG objects. Each example corresponds to a histogram of a bag
of examples generated from (X, y). The size of the complete histogram is n_features * n_bins, because
it is formed by concatenating the histogram for each input feature. This method computes the values
for <a href="#id13"><span class="problematic" id="id14">dataX_</span></a>, <a href="#id15"><span class="problematic" id="id16">dataY_</span></a> and <a href="#id17"><span class="problematic" id="id18">bincuts_</span></a> attributes</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>n_features</em><em>)</em>) – Data</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>)</em>) – True classes</p></li>
<li><p><strong>att_range</strong> (<em>array-like</em><em>, </em><em>(</em><em>2</em><em>,</em><em>1</em><em>)</em>) – Min and Max possible values of the input feature x. These values might not coincide with the actual
Min and Max values of vector x. For instance, in the case of x represents a set of probabilistic
predictions, these values will be 0 and 1. These values may be needed by compute_bincuts function</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REG.fit_regressor">
<span class="sig-name descname"><span class="pre">fit_regressor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REG.fit_regressor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REG.fit_regressor" title="Permalink to this definition">¶</a></dt>
<dd><p>This method trains the regressor model using <a href="#id19"><span class="problematic" id="id20">dataX_</span></a> and <a href="#id21"><span class="problematic" id="id22">dataY_</span></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REG.predict_bag">
<span class="sig-name descname"><span class="pre">predict_bag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bagX</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REG.predict_bag"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REG.predict_bag" title="Permalink to this definition">¶</a></dt>
<dd><p>This method makes a prediction for a testing bag represented by its PDF, bagX parameter</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>bagX</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_bins * n_classes</em><em>, </em><em>) </em><em>for REGy and</em><em> (</em><em>n_bins * n_features</em><em>, </em><em>) </em><em>for REGX</em>) – Testing bag’s PDF</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>prevalences</strong> – Contains the predicted prevalence for each class</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray, shape(n_classes, )</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REGX">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">REGX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bag_generator=&lt;quantificationlib.bag_generator.PriorShift_BagGenerator</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bins=8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bin_strategy='normal'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regression_estimator=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REGX"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REGX" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="quantificationlib.base.html#quantificationlib.base.WithoutClassifiers" title="quantificationlib.base.WithoutClassifiers"><code class="xref py py-class docutils literal notranslate"><span class="pre">WithoutClassifiers</span></code></a>, <a class="reference internal" href="#quantificationlib.multiclass.regression.REG" title="quantificationlib.multiclass.regression.REG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REG</span></code></a></p>
<blockquote>
<div><p>The idea is to learn a regression model able to predict the prevalences given a PDF distribution. In this case,
the distributions are represented using PDFs of the input features (X). To learn such regression model, this
object generates a training set of bags of examples using a selected kind of shift (prior probability shift,
covariate shift or a mix of both)</p>
<dl>
<dt>bag_generator<span class="classifier">BagGenerator object (default=PriorShift_BagGenerator())</span></dt><dd><p>Object to generate the bags with a selected shift</p>
</dd>
<dt>n_bins<span class="classifier">int (default=8)</span></dt><dd><p>Number of bins to compute the PDF of each distribution</p>
</dd>
<dt>bin_strategy<span class="classifier">str (default=’normal’)</span></dt><dd><dl>
<dt>Method to compute the boundaries of the bins:</dt><dd><p>‘equal_width’: bins of equal length (it could be affected by outliers)
‘equal_count’: bins of equal counts (considering the examples of all classes)
‘binormal’: (Only for binary quantification) It is inspired on the method devised by</p>
<blockquote>
<div><blockquote>
<div><p>(Tasche, 2019, Eq (A16b)). the cut points, $-infty &lt; c_1 &lt; ldots &lt; c_{b-1} &lt; infty$,
are computed as follows based on the assumption that the features follow a normal
distribution:</p>
</div></blockquote>
<p>$c_i =</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>rac{sigma^+ + sigma^{-}}{2} Phi^{-1}igg(
rac{i}{b}igg)  +
rac{mu^+ + mu^{-}}{2} ,  quad i=1,ldots,b-1$</p>
<blockquote>
<div><blockquote>
<div><p>where $Phi^{-1}$ is the quantile function of the standard normal distribution, and $mu$
and $sigma$ of the normal distribution are estimated as the average of those values for
the training examples of each class.</p>
</div></blockquote>
<dl>
<dt>‘normal’:  The idea is that each feacture follows a normal distribution. $mu$ and $sigma$ are</dt><dd><p>estimated as the weighted mean and std from the training distribution. The cut points
$-infty &lt; c_1 &lt; ldots &lt; c_{b-1} &lt; infty$ are computed as follows:</p>
<p>$c_i = sigma^ Phi^{-1}igg(</p>
</dd>
</dl>
</div></blockquote>
<p>rac{i}{b}igg)  + mu ,  quad i=1,ldots,b-1$</p>
<blockquote>
<div><dl class="simple">
<dt>regression_estimator: estimator object (default=None)</dt><dd><p>A regression estimator object. If the value is None the regression estimator used is a Generalized Linear
Model (GLM) from statsmodels package with logit link and Binomial family as parameters (see Baum 2008).
It is used to learn a regression model able to predict the prevalence for each class, so the method will
fit as many regression estimators as classes in multiclass problems and just one for binary problems.</p>
</dd>
<dt>verbose<span class="classifier">int, optional, (default=0)</span></dt><dd><p>The verbosity level. The default value, zero, means silent mode</p>
</dd>
</dl>
<dl class="simple">
<dt>bag_generator<span class="classifier">BagGenerator object</span></dt><dd><p>Object to generate the bags with a selected shift</p>
</dd>
<dt>n_bins<span class="classifier">int</span></dt><dd><p>Number of bins to compute the PDF of each distribution</p>
</dd>
<dt>bin_strategy<span class="classifier">str</span></dt><dd><p>Method to compute the boundaries of the bins</p>
</dd>
<dt>regression_estimator: estimator object, None</dt><dd><p>A regression estimator object</p>
</dd>
<dt>verbose<span class="classifier">int</span></dt><dd><p>The verbosity level</p>
</dd>
<dt><a href="#id23"><span class="problematic" id="id24">dataX_</span></a><span class="classifier">array-like, shape(n_bags, n_features)</span></dt><dd><p>X data for training REGX’s regressor model. Each row corresponds to the collection of histograms (one
per input feature) of the corresponding bag</p>
</dd>
<dt><a href="#id25"><span class="problematic" id="id26">dataY_</span></a><span class="classifier">array-like, shape(n_bags, n_classes)</span></dt><dd><p>Y data for training REGX’s regressor model. Each value corresponds to the prevalences of the
corresponding bag</p>
</dd>
<dt><a href="#id27"><span class="problematic" id="id28">bincuts_</span></a><span class="classifier">ndarray, shape (n_features, n_bins + 1)</span></dt><dd><p>Bin cuts for each feature</p>
</dd>
<dt><a href="#id29"><span class="problematic" id="id30">estimators_</span></a><span class="classifier">array of estimators, shape (n_classes, ) multiclass (1, ) binary quantification</span></dt><dd><p>It stores the estimators. For multiclass problems, the method learns an individual estimator
for each class</p>
</dd>
<dt><a href="#id31"><span class="problematic" id="id32">models_</span></a><span class="classifier">array of models, i.e., fitted estimators, shape (n_classes, )</span></dt><dd><p>This is the fitted regressor model for each class. It is needed when regression_estimator is None and
a GML models are used (this objects do not store the fitted model).</p>
</dd>
<dt><a href="#id33"><span class="problematic" id="id34">n_classes_</span></a><span class="classifier">int</span></dt><dd><p>The number of classes</p>
</dd>
</dl>
<p>Christopher F. Baum: Stata tip 63: Modeling proportions. The Stata Journal 8.2 (2008): 299-303</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REGX.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REGX.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REGX.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>This method just has two steps: 1) it computes a training dataset formed by a collection of bags of
examples (using create_training_set_of_distributions) and 2) it trains a regression model using said
training set just calling fit_regressor, a inherited method from REG base class</p>
<blockquote>
<div><dl class="simple">
<dt>X<span class="classifier">array-like, shape (n_examples, n_features)</span></dt><dd><p>Data</p>
</dd>
<dt>y<span class="classifier">array-like, shape (n_examples, )</span></dt><dd><p>True classes</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REGX.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REGX.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REGX.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>This method computes the histogram for the testing set X, using the bincuts for each input feature
computed by fit method and then it makes a prediction applying the regression model using the
inherited method predict_bag</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>X</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>n_features</em><em>)</em>) – Testing bag</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>prevalences</strong> – Contains the predicted prevalence for each class</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray, shape(n_classes, )</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REGy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">REGy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">estimator_train=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">estimator_test=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bag_generator=&lt;quantificationlib.bag_generator.PriorShift_BagGenerator</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bins=8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bin_strategy='equal_width'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regression_estimator=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REGy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REGy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="quantificationlib.base.html#quantificationlib.base.UsingClassifiers" title="quantificationlib.base.UsingClassifiers"><code class="xref py py-class docutils literal notranslate"><span class="pre">UsingClassifiers</span></code></a>, <a class="reference internal" href="#quantificationlib.multiclass.regression.REG" title="quantificationlib.multiclass.regression.REG"><code class="xref py py-class docutils literal notranslate"><span class="pre">REG</span></code></a></p>
<blockquote>
<div><p>The idea is to learn a regression model able to predict the prevalences given a PDF distribution. In this case,
the distributions are represented using PDFs of the predictions (y) from a classifer. To learn such regression
model, this object first trains a classifier using all data and then generates a training set of bags of
examples (in this case the predictions of each example) using a selected kind of shift (prior probability
shift, covariate shift or a mix of both)</p>
<dl>
<dt>estimator_train<span class="classifier">estimator object (default=None)</span></dt><dd><p>An estimator object implementing <cite>fit</cite> and <cite>predict_proba</cite>. It is used to train a classifier using the
examples of the training set. This classifier is used to obtain the predictions for the training
examples and to compute the PDF of each class individually using such predictions</p>
</dd>
<dt>estimator_test<span class="classifier">estimator object (default=None)</span></dt><dd><p>An estimator object implementing <cite>fit</cite> and <cite>predict_proba</cite>. It is used to classify the examples of the
testing set and to compute the distribution of the whole testing set</p>
</dd>
<dt>bag_generator<span class="classifier">BagGenerator object (default=PriorShift_BagGenerator())</span></dt><dd><p>Object to generate the bags with a selected shift</p>
</dd>
<dt>n_bins<span class="classifier">int (default=8)</span></dt><dd><p>Number of bins to compute the PDF of each distribution</p>
</dd>
<dt>bin_strategy<span class="classifier">str (default=’normal’)</span></dt><dd><dl>
<dt>Method to compute the boundaries of the bins:</dt><dd><p>‘equal_width’: bins of equal length (it could be affected by outliers)
‘equal_count’: bins of equal counts (considering the examples of all classes)
‘binormal’: (Only for binary quantification) It is inspired on the method devised by</p>
<blockquote>
<div><blockquote>
<div><p>(Tasche, 2019, Eq (A16b)). the cut points, $-infty &lt; c_1 &lt; ldots &lt; c_{b-1} &lt; infty$,
are computed as follows based on the assumption that the features follow a normal
distribution:</p>
</div></blockquote>
<p>$c_i =</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>rac{sigma^+ + sigma^{-}}{2} Phi^{-1}igg(
rac{i}{b}igg)  +
rac{mu^+ + mu^{-}}{2} ,  quad i=1,ldots,b-1$</p>
<blockquote>
<div><blockquote>
<div><p>where $Phi^{-1}$ is the quantile function of the standard normal distribution, and $mu$
and $sigma$ of the normal distribution are estimated as the average of those values for
the training examples of each class.</p>
</div></blockquote>
<dl>
<dt>‘normal’:  The idea is that each feacture follows a normal distribution. $mu$ and $sigma$ are</dt><dd><p>estimated as the weighted mean and std from the training distribution. The cut points
$-infty &lt; c_1 &lt; ldots &lt; c_{b-1} &lt; infty$ are computed as follows:</p>
<p>$c_i = sigma^ Phi^{-1}igg(</p>
</dd>
</dl>
</div></blockquote>
<p>rac{i}{b}igg)  + mu ,  quad i=1,ldots,b-1$</p>
<blockquote>
<div><dl class="simple">
<dt>regression_estimator: estimator object (default=None)</dt><dd><p>A regression estimator object. If it is None the regression estimator used is a Generalized Linear
Model (GLM) from statsmodels package with logit link and Binomial family as parameters.
It is used to learn a regression model able to predict the prevalence for each class, so the method will
fit as many regression estimators as classes in multiclass problem and just one for binary problems.</p>
</dd>
<dt>verbose<span class="classifier">int, optional, (default=0)</span></dt><dd><p>The verbosity level. The default value, zero, means silent mode</p>
</dd>
</dl>
<dl class="simple">
<dt>estimator_train<span class="classifier">estimator</span></dt><dd><p>Estimator used to classify the examples of the training set</p>
</dd>
<dt>estimator_test<span class="classifier">estimator</span></dt><dd><p>Estimator used to classify the examples of the testing bag</p>
</dd>
<dt>bag_generator<span class="classifier">BagGenerator object</span></dt><dd><p>Object to generate the bags with a selected shift</p>
</dd>
<dt>needs_predictions_train<span class="classifier">bool, True</span></dt><dd><p>It is True because PDFy quantifiers need to estimate the training distribution</p>
</dd>
<dt>probabilistic_predictions<span class="classifier">bool, True</span></dt><dd><p>This means that <a href="#id35"><span class="problematic" id="id36">predictions_train_</span></a>/<a href="#id37"><span class="problematic" id="id38">predictions_test_</span></a> contain probabilistic predictions</p>
</dd>
<dt>n_bins<span class="classifier">int</span></dt><dd><p>Number of bins to compute the PDF of each distribution</p>
</dd>
<dt>bin_strategy<span class="classifier">str</span></dt><dd><p>Method to compute the boundaries of the bins</p>
</dd>
<dt>regression_estimator: estimator object, None</dt><dd><p>A regression estimator object</p>
</dd>
<dt>verbose<span class="classifier">int</span></dt><dd><p>The verbosity level</p>
</dd>
<dt><a href="#id39"><span class="problematic" id="id40">predictions_train_</span></a><span class="classifier">ndarray, shape (n_examples, n_classes) (probabilities)</span></dt><dd><p>Predictions of the examples in the training set</p>
</dd>
<dt><a href="#id41"><span class="problematic" id="id42">predictions_test_</span></a><span class="classifier">ndarray, shape (n_examples, n_classes) (probabilities)</span></dt><dd><p>Predictions of the examples in the testing bag</p>
</dd>
<dt><a href="#id43"><span class="problematic" id="id44">classes_</span></a><span class="classifier">ndarray, shape (n_classes, )</span></dt><dd><p>Class labels</p>
</dd>
<dt><a href="#id45"><span class="problematic" id="id46">dataX_</span></a><span class="classifier">array-like, shape(n_bags, n_features)</span></dt><dd><p>X data for training REGy’s regressor model. Each row corresponds to the predictions histogram for the
examples of the corresponding bag</p>
</dd>
<dt><a href="#id47"><span class="problematic" id="id48">dataY_</span></a><span class="classifier">array-like, shape(n_bags, n_classes)</span></dt><dd><p>Y data for training REGy’s regressor model. Each value corresponds to the prevalences of the
corresponding bag</p>
</dd>
<dt><a href="#id49"><span class="problematic" id="id50">bincuts_</span></a><span class="classifier">ndarray, shape (n_features, n_bins + 1)</span></dt><dd><p>Bin cuts for each feature</p>
</dd>
<dt><a href="#id51"><span class="problematic" id="id52">estimators_</span></a><span class="classifier">array of estimators, shape (n_classes, ) multiclass (1, ) binary quantification</span></dt><dd><p>It stores the estimators. For multiclass problems, the method learns an individual estimator
for each class</p>
</dd>
<dt><a href="#id53"><span class="problematic" id="id54">models_</span></a><span class="classifier">array of models, i.e., fitted estimators, shape (n_classes, )</span></dt><dd><p>This is the fitted regressor model for each class. It is needed when regression_estimator is None and
a GML models are used (this objects do not store the fitted model).</p>
</dd>
<dt><a href="#id55"><span class="problematic" id="id56">n_classes_</span></a><span class="classifier">int</span></dt><dd><p>The number of classes</p>
</dd>
</dl>
<p>Christopher F. Baum: Stata tip 63: Modeling proportions. The Stata Journal 8.2 (2008): 299-303</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REGy.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictions_train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REGy.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REGy.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>This method just has two steps: 1) it computes a training dataset formed by a collection of bags of
examples (using create_training_set_of_distributions) and 2) it trains a regression model using said
training set just calling fit_regressor, a inherited method from REG base class</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>n_features</em><em>)</em>) – Data</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>)</em>) – True classes</p></li>
<li><p><strong>predictions_train</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>n_classes</em><em>)</em>) – Predictions of the examples in the training set</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – When estimator_train and predictions_train are both None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="quantificationlib.multiclass.regression.REGy.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictions_test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/quantificationlib/multiclass/regression.html#REGy.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#quantificationlib.multiclass.regression.REGy.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>This method first computes the histogram for the testing set X, using the bincuts computed by the fit
method and the predictions for the testing bag (X, y). These predictions may be explicited given in the
predictions_test parameter. Then it makes a prediction applying the regression model using the
inherited method predict_bag</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>n_features</em><em>)</em>) – Testing bag</p></li>
<li><p><strong>predictions_test</strong> (<em>ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_examples</em><em>, </em><em>n_classes</em><em>) </em><em>(</em><em>default=None</em><em>)</em>) – <p>They must be probabilities (the estimator used must have a <cite>predict_proba</cite> method)</p>
<p>If predictions_test is not None they are copied on <a href="#id57"><span class="problematic" id="id58">predictions_test_</span></a> and used.
If predictions_test is None, predictions for the testing examples are computed using the <cite>predict</cite>
method of estimator_test (it must be an actual estimator)</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – When estimator_test and predictions_test are both None</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>prevalences</strong> – Contains the predicted prevalence for each class</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>ndarray, shape(n_classes, )</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">





<h3><a href="../index.html">Table of Contents</a></h3>
<ul>
<li><a class="reference internal" href="#">quantificationlib.multiclass.regression module</a><ul>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REG"><code class="docutils literal notranslate"><span class="pre">REG</span></code></a><ul>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REG.create_training_set_of_distributions"><code class="docutils literal notranslate"><span class="pre">create_training_set_of_distributions()</span></code></a></li>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REG.fit_regressor"><code class="docutils literal notranslate"><span class="pre">fit_regressor()</span></code></a></li>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REG.predict_bag"><code class="docutils literal notranslate"><span class="pre">predict_bag()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REGX"><code class="docutils literal notranslate"><span class="pre">REGX</span></code></a><ul>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REGX.fit"><code class="docutils literal notranslate"><span class="pre">fit()</span></code></a></li>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REGX.predict"><code class="docutils literal notranslate"><span class="pre">predict()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REGy"><code class="docutils literal notranslate"><span class="pre">REGy</span></code></a><ul>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REGy.fit"><code class="docutils literal notranslate"><span class="pre">fit()</span></code></a></li>
<li><a class="reference internal" href="#quantificationlib.multiclass.regression.REGy.predict"><code class="docutils literal notranslate"><span class="pre">predict()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>



<h3> Source Code </h3>
<a href="https://github.com/AICGijon/quantificationlib">Gitup Repository</a>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="quantificationlib.multiclass.knn.html"
                          title="previous chapter">quantificationlib.multiclass.knn module</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="quantificationlib.ordinal.html"
                          title="next chapter">quantificationlib.ordinal package</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="quantificationlib.ordinal.html" title="quantificationlib.ordinal package"
             >next</a> |</li>
        <li class="right" >
          <a href="quantificationlib.multiclass.knn.html" title="quantificationlib.multiclass.knn module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">quantificationlib 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="quantificationlib.multiclass.html" >quantificationlib.multiclass package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">quantificationlib.multiclass.regression module</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, AIC Gijón.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>